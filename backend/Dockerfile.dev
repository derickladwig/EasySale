# Development Dockerfile for Rust Backend
# Using Rust nightly for edition 2024 support (required by base64ct dependency)
FROM rustlang/rust:nightly-slim

# Install system dependencies
RUN apt-get update && apt-get install -y \
    pkg-config \
    libssl-dev \
    sqlite3 \
    libsqlite3-dev \
    && rm -rf /var/lib/apt/lists/*

# Set working directory
WORKDIR /app

# Create data directory for SQLite database and backups
RUN mkdir -p /data/backups && chmod -R 777 /data

# Copy entire backend workspace
COPY . .

# Set SQLx to offline mode to skip compile-time verification
ENV SQLX_OFFLINE=true

# Expose API port
EXPOSE 8923

# Start development server from the server crate
# Uses default-run = "easysale-server" from Cargo.toml
CMD ["cargo", "run", "-p", "easysale-server"]
